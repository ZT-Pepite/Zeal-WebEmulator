<!--
/**
 * SPDX-FileCopyrightText: 2022 Zeal 8-bit Computer <contact@zeal8bit.com>
 *
 * SPDX-License-Identifier: Apache-2.0
 */
-->
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Zeal 8-bit Computer Emulator</title>
    <link rel="stylesheet" href="xterm/xterm.css" />
    <script src="beeper.js"></script>
    <script src="crypto/sha256.js"></script>
    <script src="xterm/xterm.js"></script>
    <link rel="stylesheet" type="text/css" href="emulator.css" media="screen" />
  </head>

  <body>
    <section id="debug">
      <table>
        <tr><td>A</td><td id="rega"></td></tr>
        <tr><td>B</td><td id="regb"></td></tr>
        <tr><td>C</td><td id="regc"></td></tr>
        <tr><td>D</td><td id="regd"></td></tr>
        <tr><td>E</td><td id="rege"></td></tr>
        <tr><td>H</td><td id="regh"></td></tr>
        <tr><td>L</td><td id="regl"></td></tr>
        <tr><td>IX</td><td id="regix" class="regaddr"></td></tr>
        <tr><td>IY</td><td id="regiy" class="regaddr"></td></tr>
        <tr><td>BC</td><td id="regbc" class="regaddr"></td></tr>
        <tr><td>DE</td><td id="regde" class="regaddr"></td></tr>
        <tr><td>HL</td><td id="reghl" class="regaddr"></td></tr>
        <tr><td>PC</td><td id="regpc" class="regaddr"></td></tr>
        <tr><td>SP</td><td id="regsp" class="regaddr"></td></tr>
        <tr><td>Flags</td><td id="flags"></td></tr>
      </table>

      <section id="romload">
        <label for="romchoice">Choose a pre-built ROM:</label><br>
        <select name="romchoice" id="romchoice">
            <option value="None">Choose:</option>
            <!-- Actually, you can add default prebuild here. Here is an example: -->
            <!-- <option value="https://github.com/Zeal8bit/Zeal-8-bit-OS/releases/download/v0.3.0/os_with_romdisk.img">offical-master-0.3.0</option> -->
        </select>

        <!-- <section id="romadvanced">
            <a href="#">Advanced...</a> -->
        <!-- </section> -->
      </section>

      <section id="romfile">
        <div style="display: none;">
          <input type="radio" id="os" name="typebin" value="OS" checked>
          <label for="os">OS</label><br>
          <input type="radio" id="program" name="typebin" value="Program">
          <label for="program">Program</label><br>
          <input type="text" id="address" name="address" value="0x2000" />
        </div>
        <label for="file-input">System binary file:</label>
        <input type="file" id="file-input" placeholder="OS file" />
        <label for="file-dump">Binary disassembly dump:</label>
        <input type="file" id="file-dump" placeholder="OS dump" />
        <label for="eeprom-bin">EEPROM image:</label>
        <input type="file" id="eeprom-bin" placeholder="EEPROM image" />
        <button id="read-button">Read file(s)</button>
        <div id="statuspan">
          <h4>Ready?</h4>
          <div id="binready" class="status">OS binary</div>
          <div id="symready" class="status">Symbols</div>
        </div>
        <pre id="file-contents"></pre>
      </section>
    </section>

    <div id="container">
      <canvas id="screen" tabindex="1" style="outline: none;"></canvas>
    </div>

    <section id="rightpanel">
      <section class="menu" id="controls">
        <img id="continue" title="Continue (F9)" src="imgs/continue.png" alt="Continue" />
        <img id="step" title="Step (F10)" src="imgs/step.png" alt="Step" />
        <img id="stepover" title="Step Over (F11)" src="imgs/stepover.png" alt="Step over" />
        <img id="stop" src="imgs/stop.png" alt="Stop" />
      </section>

      <section class="menu">
        <section class="menutitle">
            <img class="menuicon" src="imgs/down-arrow.png" />Breakpoints</section>
        <section class="menucontent">
            <section id="newbp">
                <input type="text" id="bpaddr" />
                <button id="addbp">Add</button>
            </section>

            <section id="breakpoints">
                <ul id="bps">
                </ul>
            </section>
        </section>
      </section>

      <section class="menu">
        <section class="menutitle">
            <img class="menuicon" src="imgs/right-arrow.png" />Settings</section>
        <section class="menucontent" style="display: none;">
            <label for="theme">Switch theme:</label>
            <select id="theme" name="theme">
                <option value="dark" selected>Dark (Default)</option>
                <option value="light">Light</option>
            </select>
            <label for="beepertest">Test your beeper:</label>
            <button id="beepertest" onclick="littlestar()">Beep!</button>
        </section>
      </section>

    </section>

    <section class="bottompanel">
      <section class="tabs">
        <div class="tab">Disassemble</div>
        <div id="memory-tab" class="tab">Memory view</div>
        <div class="tab active">Terminal (UART)</div>
      </section>
      <section id="memdump" class="panel hidden">
      </section>
      <section id="memview" class="panel hidden">
        <section id="dumpfields">
          <input type="text" id="dumpaddr" placeholder="Hex address" />
          <input type="text" id="dumpsize" placeholder="Size" />
          <input type="button" id="dumpnow" value="Dump" />
          <input type="button" id="dump-button" value="Dump ROM" />
          <input type="button" id="dump-eeprom-button" value="Dump EEPROM" />
          <a id="dump-link" href="#" download="rom_dump.bin" style="display: none;">Dump ROM</a>
          <a id="dump-eeprom-link" href="#" download="eeprom_dump.bin" style="display: none;">Dump EEPROM</a>

        </section>
        <section class="memline">
            <section id="current_memaddr" class="memaddr"></section>
        </section>

        <section id="dumpcontent">
        </section>

      </section>
      <section id="uartview" class="panel">
        <input type="button" id="clearterm" value="Clear" />
        <label for="baudrate">Baudrate: </label>
        <select id="baudrate">
          <option value="57600">57600</option>
          <option value="38400">38400 </option>
          <option value="19200">19200</option>
          <option value="9600">9600</option>
        </select>
        <label for="uart-file">Send a file:</label>
        <input type="file" id="uart-file" placeholder="Send a file through UART" />
        <input type="button" id="uart-file-send" value="Send" />
        <div id="terminal"></div>
      </section>
    </section>

    <script>
      const KB = 1024;
      /* 10MHz frequency */
      const CPUFREQ = 10000000;
      const TSTATES_US = 1/CPUFREQ * 1000000;

      function us_to_tstates(us) {
        return Math.floor(us / TSTATES_US);
      }

      var terminal = new Terminal();
      terminal.open(document.getElementById('terminal'));
    </script>
    <script src="jquery-3.6.0.min.js"></script>
    <script>
      const left_panel_height = $("#debug").height();
      $("#rightpanel").css('min-height', left_panel_height);
    </script>
    <script src="characters.js"></script>
    <script src="screen.js"></script>
    <script src="rom.js"></script>
    <script src="pio.js"></script>
    <script src="uart.js"></script>
    <script src="keyboard.js"></script>
    <script src="i2c.js"></script>
    <script src="ram.js"></script>
    <script src="mmu.js"></script>
    <script src="Z80.js"></script>
    <script src="zeal.js" type="text/javascript"></script>
    <script src="menus.js"></script>
  </body>
</html>
